<html>

<head>
    <script src="http://d3js.org/d3.v6.min.js" charset="utf-8"></script>
</head>

<body>
    <script type="text/javascript">
        var width = 700;
        var height = 900;

        var margin = {
            left: 30,
            right: 30
        }

        const svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        d3.csv("us-population-state-age.csv", d3.autoType).then(function(data) {
            // Fixing name of 80+ column such that it can be typed on keyboard
            data.forEach(row => {
                row["80+"] = row["≥80"];
                delete row["≥80"];
            });

            // Adding total population to data
            for (var i = 0; i < data.length; i++) {
                var pop = 0;

                Object.keys(data[i]).filter(k => k !== "name").forEach(k => {
                    pop = pop + data[i][k]
                })

                data[i].population = pop;
            }

            // Set scales and axes
            xScale = d3.scaleBand(
                data.map(d => d.name),
                [margin.left, width - margin.right]
            ).padding(0.2)

            yScale = d3.scaleLinear(
                [0, d3.max(data, d => d.population)],
                [height - margin.bottom, margin.top]
            );

            xAxis = d3.axisBottom(xScale);
            yAxis = d3.axisLeft(yScale);
        });
    </script>
</body>

</html>